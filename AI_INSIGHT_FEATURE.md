# AI智能回复功能使用说明

## 功能概述

心语迹产品现在集成了AI智能回复功能，可以在用户生成日记的同时，在AI情绪洞察的卡片中生成温暖治愈的AI回复。这个功能由专业的心理疗愈师AI提供，能够敏锐地察觉用户的情绪，并提供温暖、治愈和情绪上的支持与关怀。

## 使用路径

### 路径1：AI聊天 → 生成日记 → AI智能回复
1. 用户与AI聊天，分享心情和想法
2. 聊天结束后，点击"生成今日心语日记"按钮
3. 系统自动生成日记内容
4. 同时生成基于聊天记录的AI智能回复
5. 用户在AI情绪洞察卡片中看到温暖的心理疗愈回复

### 路径2：直接输入 → 生成日记 → AI智能回复
1. 用户直接在新建日记页面输入文本内容
2. 选择情绪标签和心情标签
3. 保存日记
4. 系统自动生成基于日记内容的AI智能回复
5. 用户在AI情绪洞察卡片中看到温暖的心理疗愈回复

## AI心理疗愈师特点

### 核心特质
- **敏锐洞察**：快速捕捉用户的情绪，并准确地分析其背后的原因
- **共情与理解**：使用亲切、温暖、非评判的语言，表达对用户感受的深刻理解
- **情感支持**：像朋友一样，给予用户正向的情绪反馈
- **实用方法**：提供简单、可行的情绪调节方法，充满关怀

### 语言风格
- **亲密友好**：使用日常对话的语气，多用感叹词、表情符号
- **温暖治愈**：文字像冬日的暖阳，给人安慰和力量
- **简洁明了**：避免冗长和说教，直击用户痛点
- **人格化**：让用户觉得是一个真实存在、关心他们的朋友

## 技术实现

### 新增文件
- `lib/ai-insight-generator.ts` - AI智能回复生成器
- `app/api/diary/direct-generate/route.ts` - 直接生成日记API
- `scripts/016_add_ai_insight_to_conversations.sql` - 数据库更新脚本

### 修改文件
- `app/api/diary/generate/route.ts` - 聊天生成日记API，集成AI智能回复
- `app/api/chat/route.ts` - 聊天API，聊天结束后生成AI智能回复
- `app/diary/new/page.tsx` - 新建日记页面，调用AI智能回复API
- `app/chat/page.tsx` - 聊天页面，提示AI智能回复功能
- `app/diary/page.tsx` - 日记列表页面，美化AI情绪洞察卡片
- `app/diary/[id]/page.tsx` - 日记详情页面，美化AI情绪洞察卡片

### 数据库更新
- 为`conversations`表添加`ai_insight`字段
- 为`diary_entries`表已有`ai_insight`字段优化显示

## 使用方法

### 1. 通过AI聊天生成日记
1. 进入聊天页面
2. 与AI分享你的心情和想法
3. 聊天结束后点击"生成今日心语日记"
4. 系统自动生成日记和AI智能回复
5. 在日记页面查看AI情绪洞察

### 2. 直接创建日记
1. 进入新建日记页面
2. 输入日记标题和内容
3. 选择情绪和心情标签
4. 保存日记
5. 系统自动生成AI智能回复
6. 在日记页面查看AI情绪洞察

## 注意事项

1. **API密钥配置**：确保`DEEPSEEK_API_KEY`环境变量已正确配置
2. **网络连接**：AI智能回复生成需要网络连接，请确保网络稳定
3. **内容长度**：AI智能回复基于用户输入内容生成，内容越丰富，回复越精准
4. **隐私保护**：所有内容都经过安全处理，保护用户隐私

## 故障排除

### 常见问题
1. **AI智能回复未生成**：检查网络连接和API密钥配置
2. **回复内容不准确**：尝试提供更详细的描述和情绪信息
3. **生成速度慢**：AI分析需要时间，请耐心等待

### 技术支持
如果遇到技术问题，请检查：
- 浏览器控制台错误信息
- 网络请求状态
- 环境变量配置
- 数据库连接状态

## 未来规划

- 支持更多情绪类型识别
- 个性化AI回复风格
- 多语言支持
- 离线模式支持
- 用户反馈优化机制
